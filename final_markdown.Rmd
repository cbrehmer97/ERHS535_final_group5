---
title: "Final"
author: "Nikki Johnson"
date: "11/13/2019"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, messages = FALSE)
```


## Load in Data
This section of code is looking at only 1 round of 'perfect' games (all 30 tiles played).

```{r Load Data}
library(readr)

jeopardy <- read_tsv("data/master_season1-35.tsv")


## Filtering to ONLY look at Round 1
clean_data <- jeopardy %>% 
  filter(round == "1") %>% 
  mutate(air_date = ymd(air_date))

## Filtering to ONLY have the episodes where the entire board was asked. 
perfect_round <- clean_data %>% 
  group_by(air_date) %>% 
  summarise(total_questions_asked = n()) %>% 
  filter(total_questions_asked == "30")

## Based on the position the questions are asked in the list, creating a column 
## that has the category position, and the value of the question
labeling_positions <- clean_data %>% 
  right_join(perfect_round, by = c("air_date")) %>% 
  group_by(air_date) %>% 
  mutate(category_number =  c("Category 1", "Category 1", "Category 1", 
                              "Category 1", "Category 1", 
                              "Category 2", "Category 2", "Category 2", 
                              "Category 2", "Category 2",
                              "Category 3", "Category 3", "Category 3", 
                              "Category 3", "Category 3", 
                              "Category 4", "Category 4", "Category 4", 
                              "Category 4", "Category 4", 
                              "Category 5", "Category 5", "Category 5", 
                              "Category 5", "Category 5",
                              "Category 6", "Category 6", "Category 6", 
                              "Category 6", "Category 6"),
          value_number = c("100", "200", "300", "400", "500", 
                           "100", "200", "300", "400", "500",
                           "100", "200", "300", "400", "500", 
                           "100", "200", "300", "400", "500",
                           "100", "200", "300", "400", "500", 
                           "100", "200", "300", "400", "500")) %>% 
  mutate(daily_double = as.factor(daily_double),
         daily_double = fct_recode(daily_double,
                               "0" = "no",
                               "1" = "yes"),
         daily_double = as.character(daily_double))


```

## Summarizing Daily Double Counts

This section of code is figuring out how many daily doubles occur in each tile. 
```{r Summarising number of daily doubles}

## Finding the number of daily doubles by category and value
daily_double_positions <- labeling_positions %>% 
  mutate(daily_double = as.numeric(daily_double),
         year = year(air_date)) %>% 
  group_by(category_number, value_number) %>%
  summarise(number_of_doubles = sum(daily_double)) %>% 
  ungroup() %>% 
  mutate(value_number = as.numeric(value_number),
         number_of_doubles = as.numeric(number_of_doubles))
```

## Heat Map (Version 1) with ggplot2

```{r Heat Map with ggplot2}
library(ggplot2)

daily_double_positions %>% 
  ggplot(aes(x = category_number, y = value_number, 
             fill = number_of_doubles )) +
  geom_tile(color = "White", size = 0.1)


```

## Plotly Heat Map

```{r Heat Map with plotly}
library(plotly)

daily_double_positions %>% 
  plot_ly(
    x = ~ category_number,
    y = ~ value_number,
    color = ~ number_of_doubles,
    type = 'heatmap'
  )

```

## Heat Maps by Year

```{r Heat Map By Year}

## Grouping by year, category and value_number
daily_double_year <- labeling_positions %>% 
  mutate(daily_double = as.numeric(daily_double),
         year = year(air_date)) %>% 
  group_by(category_number, value_number, year) %>%
  summarise(number_of_doubles = sum(daily_double)) %>% 
  ungroup() %>% 
  mutate(value_number = as.numeric(value_number),
         number_of_doubles = as.numeric(number_of_doubles)) %>% 
  mutate(value_number = factor(value_number), 
                    value_number = factor(value_number, levels = rev(levels(value_number)))) %>% 
  group_by(year) %>% 
  nest()

```

```{r Heat map MOLLY'S WORKING ON BY YEAR CODE}
library(purrr)

dd_plots <- daily_double_year %>% 
  mutate(plot = map(.x = data, 
                     ~ ggplot(data = .x, aes(x = category_number, 
                                             y = value_number, 
                                             fill = number_of_doubles)) +
                      geom_tile(color = "White", size = 0.1) +
                      labs(x = NULL, y = NULL, fill = "Number of Daily Doubles") +
                      ggtitle("The Number of Daily Doubles in Each Position by Year") +
                      scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
                      theme(legend.position = "bottom", legend.box = "horizontal") +
                      scale_x_discrete(position = "top")))

print(dd_plots$plot)
  
```

```{r Daily Double Bet Data}

daily_double_bets <- labeling_positions %>% 
  filter(daily_double == "1") %>% 
  group_by(category_number, value_number) %>% 
  summarise(mean = mean(value), 
            minimum = min(value), 
            maximum = max(value))

```

